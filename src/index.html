<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="Description" content="sdg challenge, covid-19, Africa, impact estimator, Andela">
    <title>Covid-19 Estimator</title>
    <link aria-disabled="true"  media="all" href="index.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

</head>

<body>
<div class="container">
    <nav role="navigation">
        <h2>SDG Challenge</h2>
    </nav>
    <section>
        <div id="main" class="main">
            <h2 id="init_h2">Estimate Covid-19 Impact</h2>
            <form action="javascript:;" id="estimator" role="form">
               <div class="form-div-2">
                   <label for="region">Region *</label>
                   <input id="region" type="text" name="region" required data-region="region" value="">
               </div>
                <div class="form-div-2">
                    <label for="population">Population *</label>
                    <input type="text" id="population" name="population" required data-population="population" value="" />
                </div>
                <div class="form-div-2">
                    <label for="avgAge">Average Age *</label>
                    <input type="text" id="avgAge" name="avgAge" required data-average-age="avgAge" value="" />
                </div>
                <div class="form-div-2">
                    <label for="avgDailyIncomeInUSD">Average Daily Income in USD *</label>
                    <input type="text" id="avgDailyIncomeInUSD" name="avgDailyIncomeInUSD" required data-population="avgDailyIncomeInUSD" value="" />
                </div>
                <div class="form-div-2">
                    <label for="avgDailyIncomePopulation">Average Daily Income Population *</label>
                    <input type="text" id="avgDailyIncomePopulation" name="avgDailyIncomePopulation" required data-average-daily-income-population="avgDailyIncomePopulation" value="" />
                </div>
                <div class="form-div-2">
                    <label for="timeToElapse">Time to Elapse *</label>
                    <input type="text" id="timeToElapse" name="timeToElapse" required data-time-to-elapse="timeToElapse" value="" />
                </div>
                <div class="form-div-2">
                    <label for="reportedCases">Reported Cases *</label>
                    <input type="text" id="reportedCases" name="reportedCases" required data-reported-cases="reportedCases" value="" />
                </div>
                <div class="form-div-2">
                    <label for="totalHospitalBeds">Total Hospital Beds *</label>
                    <input type="text" id="totalHospitalBeds" name="totalHospitalBeds" required data-total-hospital-beds="totalHospitalBeds" value="" />
                </div>
                <div class=" form-div-2" >
                    <label for="periodType">Period Type</label>
                    <select required name="periodType" id="periodType" data-period-type="periodType">
                        <option selected aria-selected="true" value="days" >Days</option>
                        <option value="weeks">Weeks</option>
                        <option value="months">Months</option>
                    </select>
                </div>

                <div class="form-div-1">
                    <button type="submit" data-go-estimate="go-estimate" class="btnRegister" onclick="confirmValidity(this)">Estimate</button>
                </div>
            </form>
            <div id="scenarios" class="scenarios" style="display: none">
                <div class="first-enclose">
                    <div class="best-case">
                        <h4>Best Case Scenario</h4>
                    </div>
                    <div class="best-content" id="best-content">

                    </div>
                </div>
                <div class="first-enclose">
                    <div class="worst-case">
                        <h4>Worst Case Scenario</h4>
                    </div>
                    <div class="best-content" id="worst-content">

                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>

    function confirmValidity(a){
        var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
        xhr.open('POST','estimator.php',true);
        var form = document.getElementById('estimator');

        if(form.checkValidity()){
            a.style.backgroundColor="green";
            a.innerHTML="Done";
            var d={
                region:{name:document.getElementsByName("region")[0].value,avgAge:parseFloat(document.getElementsByName("avgAge")[0].value),
                    avgDailyIncomeInUSD:parseFloat(document.getElementsByName("avgDailyIncomeInUSD")[0].value),
                    avgDailyIncomePopulation:parseFloat(document.getElementsByName("avgDailyIncomePopulation")[0].value)},
                periodType:document.getElementsByName("periodType")[0].value,
                timeToElapse:parseFloat(document.getElementsByName("timeToElapse")[0].value),
                reportedCases:parseFloat(document.getElementsByName("reportedCases")[0].value),
                population:parseFloat(document.getElementsByName("population")[0].value),
                totalHospitalBeds:parseFloat(document.getElementsByName("totalHospitalBeds")[0].value)
            }
            var json=JSON.stringify(d);
            //console.log(d);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function() {
                if (xhr.readyState>3 && xhr.status==200) handleResponse(xhr.responseText);
            };
            xhr.send(json);
        }
    }

    function handleResponse(data){
        var obj=JSON.parse(data);
        console.log(JSON.stringify(obj));
        console.log('here');
        var form=document.getElementById('estimator');
        form.style.display='none';
        document.getElementById('scenarios').style.display='block';
        document.getElementById('init_h2').innerHTML='Covid-19 Impact Estimates in '+obj.data.region.name+' Based on Different Scenarios';
        var par1=document.createElement('P');
        par1.innerHTML='This estimates assumes a period of '+ obj.data.timeToElapse +' days with '+ obj.data.reportedCases +' current reported cases';
        var main=document.getElementById('main');
        main.insertBefore(par1,form);
        var icons=['fa-hotel','fa-user-md','fa-hospital-o','fa-plus-square','fa-dollar','fa-group','fa-stethoscope'];
        var desc=['Available Hospital Beds', 'Severe Cases', 'Cases Requiring Ventilators',
            'Cases in ICU', 'Lost USD', 'Currently Infected Cases', 'Currently Estimated Cases'];
        var inp=["hospitalBedsByRequestedTime","severeCasesByRequestedTime","casesForVentilatorsByRequestedTime","casesForICUByRequestedTime",
            "dollarsInFlight","currentlyInfected","infectionsByRequestedTime"];
        for(x in obj){
            if(x=="data")continue;else if (x=='impact')cases='best-content';else cases='worst-content';
            for(var j=0;j<desc.length;j++){
                var circle_cont=document.createElement('DIV');
                circle_cont.className='circle-container';
                var circle=document.createElement('DIV');
                circle.className='circle';
                circle_cont.appendChild(circle);
                var icon=document.createElement('I');
                icon.className='fa '+icons[j];
                circle.appendChild(icon);
                var span=document.createElement('SPAN');
                span.innerHTML=obj[x][inp[j]];
                circle.appendChild(span);
                var par=document.createElement('P');
                par.innerHTML=desc[j];
                circle.appendChild(par);
                document.getElementById(cases).appendChild(circle_cont);
            }
            console.log(obj[x]);
        }

    }

</script>
</body>

</html>
